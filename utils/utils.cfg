#textdomain wesnoth-War_of_the_Jewel

# The following 4 macros were taken from IftU

#define VARIABLE_BOOLEAN_EQUALS VAR_ID RVALUE
    [variable]
        name={VAR_ID}
        boolean_equals={RVALUE}
    [/variable]
#enddef

#define VARIABLE_INCREMENT VAR_ID
    [set_variable]
        name={VAR_ID}
        add=1
    [/set_variable]
#enddef

#define VARIABLE_INC VAR_ID
    {VARIABLE_INCREMENT {VAR_ID} }
#enddef

#define VARIABLE_NUM_GREATER_OR_EQUAL_THAN VAR_ID RVALUE
    [variable]
        name={VAR_ID}
        greater_than_equal_to={RVALUE}
    [/variable]
#enddef

# Macro taken from Legend of the Invincibles
#define INCORPORATE_EFFECTS
    {VARIABLE damage $damage_inflicted}
    {VARIABLE_OP damage multiply 100}
    [set_variable]
        name=resistance
        to_variable=second_unit.resistance.$weapon.type
    [/set_variable]
    [if]
        [variable]
            name=resistance
            greater_than=0
        [/variable]
        [else]
            {VARIABLE resistance 100}
        [/else]
    [/if]
    {VARIABLE_OP damage divide $resistance}
    {CLEAR_VARIABLE resistance}
#enddef

#define CINE_FIGHT VICTIM ATTACKER PRIM_ATTACK ANIMATE KILL AMOUNT DAMAGE_TYPE

    [harm_unit]
        [filter]
            id={VICTIM}
        [/filter]

        [filter_second]
            id={ATTACKER}
        [/filter_second]

        [primary_attack]
            name={PRIM_ATTACK}
        [/primary_attack]
        animate={ANIMATE}
        kill={KILL}
        amount={AMOUNT}
        alignment=neutral
        damage_type=(DAMAGE_TYPE}
    [/harm_unit]

#enddef

#define THUNDER_LIGHTNING

    [color_adjust]
        red=100
        green=100
        blue=100
    [/color_adjust]

    [delay]
        time=10
    [/delay]

    [color_adjust]
        red=0
        green=0
        blue=0
    [/color_adjust]
    [delay]
        time=10
    [/delay]

    [sound]
        name=thunder1.wav,thunder2.wav,thunder3.wav
    [/sound]
#enddef

#define EXTRA_AQUAMARINE_TWO
    [+unit]
        [modifications]
            [object]
                [effect]
                    apply_to=new_attack
                    name=nature_flare
                    description= _ "nature flare"
                    icon=attacks/nature_flare.png
                    type=fire
                    range=ranged
                    [specials]
                        {WEAPON_SPECIAL_MAGICAL}
                    [/specials]
                    damage=6
                    number=5
                [/effect]
                [effect]
                    apply_to=new_animation
                    name=nature_flare
                    [attack_anim]
                        [filter_attack]
                            name=dark light
                        [/filter_attack]
                        {MISSILE_FRAME_NATURE_FLARE}

                        start_time=-575
                        [frame]
                            begin=-525
                            end=-425
                            sound=fire.wav
                        [/frame]
                    [/attack_anim]
                [/effect]
            [/object]
        [/modifications]
    [/unit]
#enddef

#define EXTRA_AQUAMARINE_THREE
    [+unit]
        [modifications]
            [object]
                [effect]
                    apply_to=new_attack
                    name=nature_flare
                    description= _ "nature flare"
                    icon=attacks/nature_flare.png
                    type=fire
                    range=ranged
                    [specials]
                        {WEAPON_SPECIAL_MAGICAL}
                    [/specials]
                    damage=8
                    number=6
                [/effect]
                [effect]
                    apply_to=new_animation
                    name=nature_flare
                    [attack_anim]
                        [filter_attack]
                            name=dark light
                        [/filter_attack]
                        {MISSILE_FRAME_NATURE_FLARE}

                        start_time=-575
                        [frame]
                            begin=-525
                            end=-425
                            sound=fire.wav
                        [/frame]
                    [/attack_anim]
                [/effect]
            [/object]
        [/modifications]
    [/unit]
#enddef

#define EXTRA_CRIMSON_TWO
    [+unit]
        [modifications]
            [object]
                [effect]
                    apply_to=new_attack
                    name=fireball
                    description= _ "fire burst"
                    icon=attacks/fireball.png
                    type=fire
                    range=ranged
                    [specials]
                        {WEAPON_SPECIAL_MAGICAL}
                    [/specials]
                    damage=9
                    number=4
                [/effect]
                [effect]
                    apply_to=new_animation
                    name=fireball
                    [attack_anim]
                        [filter_attack]
                            name=fireball
                        [/filter_attack]
                        {MISSILE_FRAME_FIREBALL_XY 17 -22}

                        start_time=-575
                        [frame]
                            begin=-525
                            end=-425
                            sound=fire.wav
                        [/frame]
                    [/attack_anim]
                [/effect]
            [/object]
        [/modifications]
    [/unit]
#enddef

#define EXTRA_CRIMSON_THREE
    [+unit]
        [modifications]
            [object]
                [effect]
                    apply_to=new_attack
                    name=fireball
                    description= _ "fire burst"
                    icon=attacks/fireball.png
                    type=fire
                    range=ranged
                    [specials]
                        {WEAPON_SPECIAL_MAGICAL}
                    [/specials]
                    damage=13
                    number=4
                [/effect]
                [effect]
                    apply_to=new_animation
                    name=fireball
                    [attack_anim]
                        [filter_attack]
                            name=fireball
                        [/filter_attack]
                        {MISSILE_FRAME_FIREBALL_XY 17 -22}

                        start_time=-575
                        [frame]
                            begin=-525
                            end=-425
                            sound=fire.wav
                        [/frame]
                    [/attack_anim]
                [/effect]
            [/object]
        [/modifications]
    [/unit]
#enddef

#define EXTRA_LUCENT_TWO
    [+unit]
        [modifications]
            [object]
                [effect]
                    apply_to=new_attack
                    name=sacred fire
                    description=_"sacred fire"
                    type=arcane
                    icon="attacks/sacred-fire.png"
                    range=ranged
                    [specials]
                        {WEAPON_SPECIAL_MAGICAL}
                    [/specials]
                    damage=7
                    number=4
                [/effect]
                [effect]
                    apply_to=new_animation
                    name=sacred fire
                    [attack_anim]
                        [filter_attack]
                            name=sacred fire
                        [/filter_attack]
                        {MISSILE_FRAME_SACRED_FIRE}
                        start_time=-300
                        [frame]
                            begin=-150
                            end=-75
                            halo=halo/holy/halo6.png
                        [/frame]
                        [if]
                            hits=yes
                            [frame]
                                begin=-75
                                end=0
                                sound={SOUND_LIST:HOLY}
                                halo=halo/holy/halo1.png
                            [/frame]
                        [/if]
                        [else]
                            hits=no
                            [frame]
                                begin=-75
                                end=0
                                sound={SOUND_LIST:HOLY_MISS}
                                halo=halo/holy/halo1.png
                            [/frame]
                        [/else]
                        [frame]
                            begin=0
                            end=75
                            halo=halo/holy/halo3.png
                        [/frame]
                        [frame]
                            begin=75
                            end=150
                            halo=halo/holy/halo5.png
                        [/frame]

                        [frame]
                            begin=150
                            end=200
                            halo=halo/holy/halo6.png
                        [/frame]
                    [/attack_anim]
                [/effect]
            [/object]
        [/modifications]
    [/unit]
#enddef

#define EXTRA_LUCENT_THREE
    [+unit]
        [modifications]
            [object]
                [effect]
                    apply_to=new_attack
                    name=sacred fire
                    description=_"sacred fire"
                    type=arcane
                    icon="attacks/sacred-fire.png"
                    range=ranged
                    [specials]
                        {WEAPON_SPECIAL_MAGICAL}
                    [/specials]
                    damage=11
                    number=4
                [/effect]
                [effect]
                    apply_to=new_animation
                    name=sacred fire
                    [attack_anim]
                        [filter_attack]
                            name=sacred fire
                        [/filter_attack]
                        {MISSILE_FRAME_SACRED_FIRE}
                        start_time=-300
                        [frame]
                            begin=-150
                            end=-75
                            halo=halo/holy/halo6.png
                        [/frame]
                        [if]
                            hits=yes
                            [frame]
                                begin=-75
                                end=0
                                sound={SOUND_LIST:HOLY}
                                halo=halo/holy/halo1.png
                            [/frame]
                        [/if]
                        [else]
                            hits=no
                            [frame]
                                begin=-75
                                end=0
                                sound={SOUND_LIST:HOLY_MISS}
                                halo=halo/holy/halo1.png
                            [/frame]
                        [/else]
                        [frame]
                            begin=0
                            end=75
                            halo=halo/holy/halo3.png
                        [/frame]
                        [frame]
                            begin=75
                            end=150
                            halo=halo/holy/halo5.png
                        [/frame]

                        [frame]
                            begin=150
                            end=200
                            halo=halo/holy/halo6.png
                        [/frame]
                    [/attack_anim]
                [/effect]
            [/object]
        [/modifications]
    [/unit]
#enddef

#define EXTRA_UMBRA_TWO
    [+unit]
        [modifications]
            [object]
                [effect]
                    apply_to=new_attack
                    name=chill wave
                    description=_"chill wave"
                    type=cold
                    [specials]
                        {WEAPON_SPECIAL_MAGICAL}
                    [/specials]
                    range=ranged
                    damage=13
                    number=2
                    icon=attacks/iceball.png
                [/effect]
                [effect]
                    apply_to=new_animation
                    name=chill wave
                    [attack_anim]
                        [filter_attack]
                            name=chill wave
                        [/filter_attack]
                        missile_start_time=-100
                        [missile_frame]
                            image="projectiles/darkmissile-n.png:200"
                            image_diagonal="projectiles/darkmissile-ne.png"
                        [/missile_frame]

                        start_time=-300

                        [frame]
                            halo=halo/undead/black-magic-[1~5].png:[75*4,50]
                        [/frame]
                        {SOUND:HIT_AND_MISS magic-dark.ogg magic-dark-miss.ogg -75}
                    [/attack_anim]
                [/effect]
            [/object]
        [/modifications]
    [/unit]
#enddef

#define EXTRA_UMBRA_THREE
    [+unit]
        [modifications]
            [object]
                [effect]
                    apply_to=new_attack
                    name=chill wave
                    description=_"chill wave"
                    type=cold
                    [specials]
                        {WEAPON_SPECIAL_MAGICAL}
                    [/specials]
                    range=ranged
                    damage=17
                    number=2
                    icon=attacks/iceball.png
                [/effect]
                [effect]
                    apply_to=new_animation
                    name=chill wave
                    [attack_anim]
                        [filter_attack]
                            name=chill wave
                        [/filter_attack]
                        missile_start_time=-100
                        [missile_frame]
                            image="projectiles/darkmissile-n.png:200"
                            image_diagonal="projectiles/darkmissile-ne.png"
                        [/missile_frame]

                        start_time=-300

                        [frame]
                            halo=halo/undead/black-magic-[1~5].png:[75*4,50]
                        [/frame]
                        {SOUND:HIT_AND_MISS magic-dark.ogg magic-dark-miss.ogg -75}
                    [/attack_anim]
                [/effect]
            [/object]
        [/modifications]
    [/unit]
#enddef

#define SCATTER NUMBER TYPE RADIUS TERRAIN XAXIS YAXIS SIDE FACINGSIDE

    {SCATTER_UNITS {NUMBER} {TYPE} {RADIUS} (
        terrain={TERRAIN}
        x={XAXIS}
        y={YAXIS}

        [not]
            [filter]
            [/filter]
        [/not]

        [not]
            [filter_adjacent_location]
                [filter]
                [/filter]
            [/filter_adjacent_location]
        [/not]
    ) (
        side={SIDE}
        facing={FACINGSIDE}
        generate_name=yes
        random_traits=yes
    )}
#enddef

#define SCATTER_GUARDIAN NUMBER TYPE RADIUS TERRAIN XAXIS YAXIS SIDE FACINGSIDE

    {SCATTER_UNITS {NUMBER} {TYPE} {RADIUS} (
        terrain={TERRAIN}
        x={XAXIS}
        y={YAXIS}

        [not]
            [filter]
            [/filter]
        [/not]

        [not]
            [filter_adjacent_location]
                [filter]
                [/filter]
            [/filter_adjacent_location]
        [/not]
    ) (
        side={SIDE}
        facing={FACINGSIDE}
        generate_name=yes
        random_traits=yes
        ai_special=guardian
    )}
#enddef

#define TRAIT_GOLEM
    # Units with trait Golem cannot be drained, poisoned or plagued.
    [trait]
        id=golem
        availability="musthave"
        male_name= _ "golem"
        female_name= _ "female^golem"
        description= _ "Immune to drain, poison and plague"
        [effect]
            apply_to=status
            add=not_living
        [/effect]
    [/trait]
#enddef

#define MAATKARIAN_NAMES
    male_names= _ "Amun,Ammon,Ahmose,Amenemhab,Amenemhet,Amenhotep,Amenken,Amenmose,Amunemhat,Anen,Ankhaf,Banefre,Baufre,Bay,Beb,Bek,Cnemon,Cnemothep,Dedu,Djar,Djau,Djedefhor,Djoser,Hapuneseb,Harkhaf,Haremhab,Hekaib,Hemiunu,Henenu,Herihor,Horwedja,Huya,Ibi,Ikernofret,Imhotep,Ineni,Intef,Ipuki,Irsu,Iumeri,Kagemni,Kawab,Kenamon,Kewab,Kha,Khamet,Khenemsu,Khensuhotep,Khuenre,Kheruef,Knumhotep,Khui,Maherpa,Mahu,Mai,Ma'nakhtuf,Masaharta,Maya,Meketre,Menkhaf,Menna,Meri,Merimose,Meriptah,Meryatum,Merytatum,Metjen,Minnakht,Nakhte,Nebamun,Nebenteru,Nebetka,Neferhotep,Neferma'at,Neferu,Nehesy,Nehi,Nekaure',Nekhebu,Nekure,Nessumontu,Padiaset,Panehsi,Paser,Pawah,Pawero,Ptah-Shepses,Rahotep,Raia,Ramose,Ranofer,Rawer,Re'hotpe,Rekhmire,Renni,Rudjek,Sabaf,Sarenpet,Sebni,Senenmut,Sen-nefer,Setka,Sihathor,Surero,Tchanun,Tchay,Thaneni,Theshen,Thethi,Urhiya,Wajmose,Wenamon,Weni,Wenisankh,Wesir,Woser,Yuia,Yuny,Yuya"
    female_names= _ "A'at,Ahhotep,Ahset,Amtes,Amunet,Ana,Aneksi,Ankhesenamon,Ankhetitat,Ankhnes,Aoh,Ashait,Atet,Bakt,Beketaten,Berenib,Betresh,Bint-Anath,Bunefer,Dedyet,Fent-Ankhet,Hapynma'at,Hedjekenu,Henite,Hent,Hentaneb,Hentmire,Henutmire,Henutsen,Herit,Hetepheres,Inhapi,Intakaes,Ipwet,Isetnofret,Isis,Itet,Kasmut,Kemanut,Kemsit,Kemsiyet,Khama'at,Khemut,Khentikus,Khenut,Kiya,Maketaten,Maia,Menhet,Menwi,Mereneith,Mereryet,Meresankh,Meritites,Merseger,Meryetamun,Meryetre,Merytamon,Merytaten,Mayati,Muyet,Nebet,Nebettawy,Neferhent,Neferhetep,Neferkent,Nefertari,Nefertiti,Nefret,Neith,Neithotep,Nitemat,Nubkhas,Rai,Sadeh,Sadek,Sebek,Senebsen,Senisonbe,Sitamun,Sitre,Ta-Opet,Takhaet,Tarset,Taweret,Tem,Tetisheri,Tiye,Tuia,Weret-Imtes"
#enddef

#define CHOMI_NAMES
    male_names= _ "Abidemi,Abimbola,Abiodun,Abioye,Ade,Adebowale,Adegoke,Adetokunbo,Adisa,Afolabi,Ajayi,Akia,Akinsanya,Akintunde,Akinwole,Akinyemi,Alaba,Alafin,Alake,Ayo,Ayodele,Ayokunle,Ayomide,Ayotunde,Babajide,Babatunde,Bamidele,Bosede,Ekundayo,Eniola,Femi,Folami,Idowu,Iyabo,Iyioluwa,Kayin,Kayode,Lekan,Olabode,Olamide,Olamilekan,Olanrewaju,Oluf,Olufemi,Olufunke,Olufunmilayo,Olufunmilola,Olujimi,Olukayode,Olumide,Oluwafunmilayo,Oluwakanyinsola,Oluwasegun,Oluwaseun,Oluwaseyi,Oluwatosin,Oluwatoyin,Oluwayemisi,Accalu,Adapa,Adar,Adasi,Ahsera,Akhiramu,Anshar,Beldagon,Eparna,Humri,Ivalush,Kadjarti,Kamashalta,Kemosh,Kibaba,Kinabua,Lusuna,Mitunnu,Samasa,Shalmaneser,Shamash,Shareser,Shemsh-Ibin,Sibahe,Suma,Tamzi"
#enddef

#define WASHRAHA_NAMES
    male_names= _ "Accalu,Adapa,Adar,Adasi,Ahsera,Akhiramu,Anshar,Beldagon,Eparna,Humri,Ivalush,Kadjarti,Kamashalta,Kemosh,Kibaba,Kinabua,Lusuna,Mitunnu,Samasa,Shalmaneser,Shamash,Shareser,Shemsh-Ibin,Sibahe,Suma,Tamzi"
    female_names= _ "Arni,Asha,Ashi,Asin,Asya,Aabha,Aadya,Aaoka,Bani,Beena,Bhavi,Badari,Barsha,Basabi,Bhadra,Bhavya,Bipasha,Bageshri,Harsha,Harshi,Hasika,Hasita,Lavali,Lekhna,Rashi,Rasmi,Rasna,Veena,Veera,Venah,Venya,Varsha,Vanshi,Yashi,Yousha,Yashita,Alala,Allat,Amuhia,Anat,Anunit,Atheh,Belit,Gula,Mylitta,Nairi,Nuri,Pirisati,Sammuramat,Seruya,Shala,Tabuya,Zirat-Banit"
#enddef

#define SKIRONIAN_NAMES
    male_names= _ "Achaikos,Agapetos,Agapios,Agathon,Alcaeus,Alexios,Alkibiades,Ampelios,Amyntas,Anakletos,Anatolios,Andreas,Androkles,Aniketos,Archelaos,Archippos,Argyros,Athanas,Callias,Chrysanthos,Cleisthenes,Cyrus,Damianos,Dareios,Diocles,Diodoros,Diokles,Drakon,Eirenaios,Epaphras,Epiktetos,Erasmos,Euphemios,Euphranor,Eustorgios,Euthymios,Eutychos,Gennadios,Georgios,Heliodoros,Hermokrates,Hermolaos,Heron,Hypatos,Iason,Kallias,Karpos,Kyriakos,Kyros,Loukianos,Mnason,Myron,Nikanor,Nikias,Onesimos,Phaidros,Phokas,Photios,Seleukos,Thales,Theokritos,Theron,Timaios,Tryphon,Xenon,Zopyros,Zotikos"
#enddef

#undef AI_CONTROLLER_NOTE
#define AI_CONTROLLER_NOTE
    # Note for the objectives that instructions can be issued to an allied AI side
    [note]
        description= _ "In this scenario, you may issue instructions to an allied side by right-clicking on a unit that belongs to it."
    [/note]
#enddef

#undef AI_CONTROLLER
#define AI_CONTROLLER AFFIX PLAYER_SIDES ALLY_SIDES VARIABLES_WML
    # Right-click content menu item for issuing instructions to an allied AI side
    [event]
        name=prestart

        [set_variables]
            name=ai_controller_{AFFIX}

            # This block contains all the default settings and options.
            [literal]
                enabled=yes
                option_name= _ "Instruct ally"
                player_side={PLAYER_SIDES}
                ally_sides={ALLY_SIDES}
                disabled_for_sides=0

                [overview_message_has_instructions]
                    speaker=narrator
                    caption= _ "Instruct ally"
                    message= _ "$ally_leader.name (side $ally_side|) is carrying out the following instructions:"
                    image=wesnoth-icon.png
                [/overview_message_has_instructions]

                [overview_message_no_instructions]
                    speaker=narrator
                    caption= _ "Instruct ally"
                    message= _ "$ally_leader.name (side $ally_side|) has not been given any instructions and is acting normally."
                    image=wesnoth-icon.png
                [/overview_message_no_instructions]

                ################

                [aggression]
                    option_description= _ "Be more aggressive"
                    currently_doing_description= _ "aggressive."

                    [show_if]
                    [/show_if]

                    [actions_when_applied]
                        {MODIFY_AI_ADD_SIMPLE_ASPECT $ally_side aggression set_by_ai_controller "0.9"}
                        {MODIFY_AI_ADD_SIMPLE_ASPECT $ally_side caution set_by_ai_controller "0.1"}
                    [/actions_when_applied]

                    [message_when_applied]
                    [/message_when_applied]
                [/aggression]

                ################

                [caution]
                    option_description= _ "Be more defensive"
                    currently_doing_description= _ "defensive."

                    [actions_when_applied]
                        {MODIFY_AI_ADD_SIMPLE_ASPECT $ally_side aggression set_by_ai_controller "0.1"}
                        {MODIFY_AI_ADD_SIMPLE_ASPECT $ally_side caution set_by_ai_controller "1.0"}
                    [/actions_when_applied]
                [/caution]

                ################

                [focus_on_enemy]
                    option_description= _ "Focus on defeating..."
                    currently_doing_description= _ "focusing on defeating $ai_controller.side_$ally_side|_current_settings.focus_on_enemy.side_description|."

                    [actions_when_applied]
                        [set_variables]
                            name=focus_on_enemy_options_message

                            [insert_tag]
                                name=value
                                variable=header_message
                            [/insert_tag]
                        [/set_variables]

                        {CLEAR_VARIABLE focus_on_enemy_options_message.option}

                        [store_side]
                            side=$ally_side
                            variable=stored_ally_side
                        [/store_side]

                        {VARIABLE temp_i 1}

                        [while]
                            [variable]
                                name=temp_i
                                less_than=10
                            [/variable]

                            [do]
                                [store_side]
                                    side=$temp_i
                                    variable=stored_other_side
                                [/store_side]

                                [if]
                                    [variable]
                                        name=stored_ally_side.team_name
                                        not_equals=$stored_other_side.team_name
                                    [/variable]

                                    [have_unit]
                                        side=$temp_i
                                    [/have_unit]

                                    [then]
                                        [if]
                                            [have_unit]
                                                side=$temp_i
                                                canrecruit=yes

                                                [filter_vision]
                                                    side=$side_number
                                                    visible=yes
                                                [/filter_vision]
                                            [/have_unit]

                                            [then]
                                                [store_unit]
                                                    [filter]
                                                        side=$temp_i
                                                        canrecruit=yes
                                                    [/filter]

                                                    kill=no
                                                    variable=side_i_leader
                                                [/store_unit]

                                                {VARIABLE this_enemy_image "$side_i_leader.image~TC($temp_i|,$side_i_leader.flag_rgb|)"}
                                                {VARIABLE this_enemy_label _"Side $temp_i"}
                                                {VARIABLE this_enemy_description "$side_i_leader.name"}
                                            [/then]

                                            [else]
                                                {VARIABLE this_enemy_image "misc/blank-hex.png"}
                                                {VARIABLE this_enemy_label _"Side $temp_i"}
                                                {VARIABLE this_enemy_description ""}
                                                {VARIABLE ai_controller.side_$ally_side|_current_settings.focus_on_enemy.side_description _"side $temp_i"}
                                            [/else]
                                        [/if]

                                        [set_variables]
                                            name=focus_on_enemy_options_message.option
                                            mode=append

                                            [value]
                                                image=$this_enemy_image
                                                label=$this_enemy_label
                                                description=$this_enemy_description

                                                [command]
                                                    {VARIABLE ai_controller.side_$ally_side|_current_settings.focus_on_enemy.side $temp_i}
                                                    {VARIABLE ai_controller.side_$ally_side|_current_settings.focus_on_enemy.side_description _"side $temp_i ($side_i_leader.name|)"}

                                                    {MODIFY_AI_ADD_GOAL $ally_side (
                                                        [goal]
                                                            id=set_by_ai_controller
                                                            value=20
                                                            [criteria]
                                                                side=$temp_i
                                                            [/criteria]
                                                        [/goal]
                                                    )}
                                                [/command]
                                            [/value]
                                        [/set_variables]
                                    [/then]
                                [/if]

                                {VARIABLE_OP temp_i add 1}
                            [/do]
                        [/while]

                        [set_variables]
                            name=focus_on_enemy_options_message.option
                            mode=append

                            [value]
                                label= _ "Back"

                                [command]
                                [/command]
                            [/value]
                        [/set_variables]

                        [insert_tag]
                            name=message
                            variable=focus_on_enemy_options_message
                        [/insert_tag]

                        {CLEAR_VARIABLE stored_ally_side,stored_other_side,focus_on_enemy_options_message,side_i_leader,temp_i,this_enemy_image,this_enemy_label,this_enemy_description}
                    [/actions_when_applied]
                [/focus_on_enemy]

                ################

                [protect]
                    option_description= _ "Focus on protecting..."
                    currently_doing_description= _ "focusing on protecting $ai_controller.side_$ally_side|_current_settings.protect.side_description|."

                    [actions_when_applied]
                        [set_variables]
                            name=protect_options_message

                            [insert_tag]
                                name=value
                                variable=header_message
                            [/insert_tag]
                        [/set_variables]

                        {CLEAR_VARIABLE protect_options_message.option}

                        [store_side]
                            side=$ally_side
                            variable=stored_ally_side
                        [/store_side]

                        {VARIABLE temp_i 1}

                        [while]
                            [variable]
                                name=temp_i
                                less_than=10
                            [/variable]

                            [do]
                                [store_side]
                                    side=$temp_i
                                    variable=stored_other_side
                                [/store_side]

                                [if]
                                    [variable]
                                        name=ally_side
                                        not_equals=$temp_i
                                    [/variable]

                                    [variable]
                                        name=stored_ally_side.team_name
                                        equals=$stored_other_side.team_name
                                    [/variable]

                                    [have_unit]
                                        side=$temp_i
                                    [/have_unit]

                                    [then]
                                        [if]
                                            [have_unit]
                                                side=$temp_i
                                                canrecruit=yes
                                            [/have_unit]

                                            [then]
                                                [store_unit]
                                                    [filter]
                                                        side=$temp_i
                                                        canrecruit=yes

                                                        [filter_vision]
                                                            side=$side_number
                                                            visible=yes
                                                        [/filter_vision]
                                                    [/filter]

                                                    kill=no
                                                    variable=side_i_leader
                                                [/store_unit]

                                                {VARIABLE this_ally_image "$side_i_leader.image~TC($temp_i|,$side_i_leader.flag_rgb|)"}
                                                {VARIABLE this_ally_label _"Side $temp_i"}
                                                {VARIABLE this_ally_description "$side_i_leader.name"}
                                            [/then]

                                            [else]
                                                {VARIABLE this_ally_image "misc/blank-hex.png"}
                                                {VARIABLE this_ally_label _"Side $temp_i"}
                                                {VARIABLE this_ally_description ""}
                                                {VARIABLE ai_controller.side_$ally_side|_current_settings.protect.side_description _"side $temp_i"}
                                            [/else]
                                        [/if]

                                        [set_variables]
                                            name=protect_options_message.option
                                            mode=append

                                            [value]
                                                image=$this_ally_image
                                                label=$this_ally_label
                                                description=$this_ally_description

                                                [command]
                                                    {VARIABLE ai_controller.side_$ally_side|_current_settings.protect.side $temp_i}
                                                    {VARIABLE ai_controller.side_$ally_side|_current_settings.protect.side_description _"side $temp_i ($side_i_leader.name|)"}

                                                    {MODIFY_AI_ADD_GOAL $ally_side (
                                                        [goal]
                                                            id=set_by_ai_controller
                                                            name=protect_unit
                                                            value=20
                                                            [criteria]
                                                                side=$temp_i
                                                            [/criteria]
                                                        [/goal]
                                                    )}
                                                [/command]
                                            [/value]
                                        [/set_variables]
                                    [/then]
                                [/if]

                                {VARIABLE_OP temp_i add 1}
                            [/do]
                        [/while]

                        [set_variables]
                            name=protect_options_message.option
                            mode=append

                            [value]
                                label= _ "Back"

                                [command]
                                [/command]
                            [/value]
                        [/set_variables]

                        [insert_tag]
                            name=message
                            variable=protect_options_message
                        [/insert_tag]

                        {CLEAR_VARIABLE stored_ally_side,stored_other_side,side_i_leader,protect_options_message,temp_i,this_ally_image,this_ally_label,this_ally_description}
                    [/actions_when_applied]
                [/protect]

                ################

#ifdef __UNUSED
                [defend_location]
                    type=objective

                    [ai]
                        [goal]
                            name=protect_location
                            [criteria]
                                x=$ai_controller.side_$ally_side|_current_settings.defend_location.x
                                y=$ai_controller.side_$ally_side|_current_settings.defend_location.y
                            [/criteria]
                            protect_radius=6
                            value=20
                        [/goal]
                    [/ai]

                    [option]
                        label= _ "Defend a location..."

                        [show_if]
                            [variable]
                                name=ai_controller_{AFFIX}.defend_location.disabled
                                not_equals=yes
                            [/variable]
                        [/show_if]

                        [command]
                            {VARIABLE ai_controller_{AFFIX}.defend_location.picker_active yes}
                            {VARIABLE ai_controller_{AFFIX}.defend_location.original_controller_invokation_x $x1}
                            {VARIABLE ai_controller_{AFFIX}.defend_location.original_controller_invokation_y $y1}
                            {VARIABLE ai_controller_finished yes}

                            [print]
                                text= _ "Right-click to select a location to defend"
                                duration=100
                                {COLOR_WHITE}
                            [/print]

                            [set_menu_item]
                                id=ai_controller_defend_location_picker
                                description= _ "Defend this location"

                                [show_if]
                                    [variable]
                                        name=ai_controller_{AFFIX}.defend_location.picker_active
                                        boolean_equals=yes
                                    [/variable]
                                [/show_if]

                                [command]
                                    {VARIABLE ai_controller.side_$ally_side|_current_settings.defend_location.x $x1}
                                    {VARIABLE ai_controller.side_$ally_side|_current_settings.defend_location.y $y1}
                                    {VARIABLE ai_controller_{AFFIX}.defend_location.picker_active no}

                                    {VARIABLE order_type defend_location}

                                    {VARIABLE ai_controller.side_$ally_side|_current_settings.current_objective defend_location}
                                    {VARIABLE ai_controller.side_$ally_side|_current_settings.currently_doing_objective_description _"focusing on defending the area around $x1|,$y1|."}

                                    {MODIFY_AI_ADD_GOAL $ally_side (
                                        [goal]
                                            id=set_by_ai_controller
                                            name=protect_location
                                            value=20
                                            [criteria]
                                                x,y=$x1,$y1
                                            [/criteria]
                                        [/goal]
                                    )}

                                    [print]
                                        text=" "    # wmllint: ignore
                                        duration=1
                                    [/print]

                                    [fire_event]
                                        name=menu item ai_controller

                                        [primary_unit]
                                            x=$ai_controller_{AFFIX}.defend_location.original_controller_invokation_x
                                            y=$ai_controller_{AFFIX}.defend_location.original_controller_invokation_y
                                        [/primary_unit]
                                    [/fire_event]
                                [/command]
                            [/set_menu_item]

                            [event]
                                name=select,recruit,recall,side turn,menu item ai_controller

                                [if]
                                    [variable]
                                        name=ai_controller_{AFFIX}.defend_location.picker_active
                                        boolean_equals=yes
                                    [/variable]

                                    [then]
                                        {VARIABLE ai_controller_{AFFIX}.defend_location.picker_active no}

                                        [print]
                                            text= _ "Location selection canceled"
                                            duration=100
                                            {COLOR_WHITE}
                                        [/print]
                                    [/then]
                                [/if]
                            [/event]
                        [/command]
                    [/option]
                [/defend_location]
#endif

                ################

                [revoke_objective_orders]
                    option_description= _ "Clear objective orders"
                    currently_doing_description= _"none set."

                    [actions_when_applied]
                        {MODIFY_AI_DELETE_GOAL $ally_side set_by_ai_controller}

                        {CLEAR_VARIABLE ai_controller.side_$ally_side|_current_settings.current_objective}
                    [/actions_when_applied]
                [/revoke_objective_orders]

                ################

                [revoke_behavior_orders]
                    option_description= _ "Clear behavior orders"
                    currently_doing_description= _"none set."

                    [actions_when_applied]
                        {MODIFY_AI_DELETE_ASPECT $ally_side aggression set_by_ai_controller}
                        {MODIFY_AI_DELETE_ASPECT $ally_side caution set_by_ai_controller}

                        {CLEAR_VARIABLE ai_controller.side_$ally_side|_current_settings.current_behavior}
                    [/actions_when_applied]
                [/revoke_behavior_orders]

                ################

                [revoke_all_orders]
                    option_description= _ "Clear all orders"

                    [actions_when_applied]
                        {MODIFY_AI_DELETE_GOAL $ally_side set_by_ai_controller}
                        {MODIFY_AI_DELETE_ASPECT $ally_side aggression set_by_ai_controller}
                        {MODIFY_AI_DELETE_ASPECT $ally_side caution set_by_ai_controller}

                        {CLEAR_VARIABLE ai_controller.side_$ally_side|_current_settings}
                    [/actions_when_applied]
                [/revoke_all_orders]
            [/literal]
        [/set_variables]

        [set_variables]
            name=ai_controller_{AFFIX}
            mode=merge

            [literal]
                {VARIABLES_WML}
            [/literal]
        [/set_variables]

        [set_menu_item]
            id=ai_controller_{AFFIX}
            description=$ai_controller_{AFFIX}.option_name

            [show_if]
                [have_unit]
                    side=$ai_controller_{AFFIX}.ally_sides
                    x,y=$x1,$y1

                    [not]
                        side=$ai_controller_{AFFIX}.disabled_for_sides
                    [/not]
                [/have_unit]

                [variable]
                    name=ai_controller_{AFFIX}.enabled
                    equals=yes
                [/variable]

                [variable]
                    name=ai_controller_{AFFIX}.player_side
                    contains=$side_number
                [/variable]

                [variable]
                    name=ai_controller_{AFFIX}.defend_location.picker_active
                    boolean_equals=no
                [/variable]
            [/show_if]

            [command]
                [store_unit]
                    [filter]
                        x,y=$x1,$y1
                    [/filter]

                    kill=no
                    variable=ally_unit
                [/store_unit]

                [store_unit]
                    [filter]
                        side=$ally_unit.side
                        canrecruit=yes
                    [/filter]

                    kill=no
                    variable=ally_leader
                [/store_unit]

                {VARIABLE ally_side $ally_leader.side}

                [if]
                    [variable]
                        name=ai_controller.side_$ally_side|_original_settings.side
                        equals=$empty
                    [/variable]

                    [then]
                        [store_side]
                            side=$ally_side
                            variable=ai_controller.side_$ally_side|_original_settings
                        [/store_side]

                        [set_variables]
                            name=ai_controller.side_$ally_side|_original_settings.ai_settings

                            [value]
                                side=$ally_side

                                [insert_tag]
                                    name=ai
                                    variable=ally_leader.ai
                                [/insert_tag]
                            [/value]
                        [/set_variables]
                    [/then]
                [/if]

                {CLEAR_VARIABLE ai_controller_finished}

                [while]
                    [variable]
                        name=ai_controller_finished
                        not_equals=yes
                    [/variable]

                    [do]
                        [if]
                            [variable]
                                name=ai_controller.side_$ally_side|_current_settings.current_objective
                                equals=$empty
                            [/variable]

                            [then]
                                {VARIABLE ai_controller.side_$ally_side|_current_settings.currently_doing_objective_description _"none set."}
                            [/then]
                        [/if]

                        [if]
                            [variable]
                                name=ai_controller.side_$ally_side|_current_settings.current_behavior
                                equals=$empty
                            [/variable]

                            [then]
                                {VARIABLE ai_controller.side_$ally_side|_current_settings.currently_doing_behavior_description _"none set."}
                            [/then]
                        [/if]

                        [if]
                            [variable]
                                name=ai_controller.side_$ally_side|_current_settings.current_objective
                                equals=$empty
                            [/variable]

                            [variable]
                                name=ai_controller.side_$ally_side|_current_settings.current_behavior
                                equals=$empty
                            [/variable]

                            [then]
                                [set_variables]
                                    name=ai_controller_{AFFIX}.main_menu_message

                                    [insert_tag]
                                        name=value
                                        variable=ai_controller_{AFFIX}.overview_message_no_instructions
                                    [/insert_tag]
                                [/set_variables]
                            [/then]

                            [else]
                                [set_variables]
                                    name=ai_controller_{AFFIX}.main_menu_message

                                    [insert_tag]
                                        name=value
                                        variable=ai_controller_{AFFIX}.overview_message_has_instructions
                                    [/insert_tag]
                                [/set_variables]
                            [/else]
                        [/if]

                        {VARIABLE ai_controller_{AFFIX}.main_menu_message.message "$ai_controller_{AFFIX}.main_menu_message.message"+"
<span color='black'>-</span>"+"
"+_"Objective: $ai_controller.side_$ally_side|_current_settings.currently_doing_objective_description
Behavior: $ai_controller.side_$ally_side|_current_settings.currently_doing_behavior_description"+"
<span color='black'>-</span>"}

                        [set_variables]
                            name=header_message
                            [insert_tag]
                                name=value
                                variable=ai_controller_{AFFIX}.main_menu_message
                            [/insert_tag]
                        [/set_variables]

                        [set_variables]
                            name=ai_controller_{AFFIX}.main_menu_message.option

                            [literal]
                                label= _ "Set objective..."

                                [command]
                                    [set_variables]
                                        name=set_objective_message

                                        [insert_tag]
                                            name=value
                                            variable=header_message
                                        [/insert_tag]
                                    [/set_variables]

                                    {CLEAR_VARIABLE set_objective_message.option}

                                    [set_variables]
                                        name=set_objective_message.option

                                        [value]
                                            label=$ai_controller_{AFFIX}.focus_on_enemy.option_description

                                            [insert_tag]
                                                name=show_if
                                                variable=ai_controller_{AFFIX}.focus_on_enemy.show_if
                                            [/insert_tag]

                                            [command]
                                                {VARIABLE objective_picked focus_on_enemy}
                                            [/command]
                                        [/value]

                                        [value]
                                            label=$ai_controller_{AFFIX}.protect.option_description

                                            [insert_tag]
                                                name=show_if
                                                variable=ai_controller_{AFFIX}.protect.show_if
                                            [/insert_tag]

                                            [command]
                                                {VARIABLE objective_picked protect}
                                            [/command]
                                        [/value]

                                        [value]
                                            label=$ai_controller_{AFFIX}.revoke_objective_orders.option_description

                                            [insert_tag]
                                                name=show_if
                                                variable=ai_controller_{AFFIX}.revoke_objective_orders.show_if
                                            [/insert_tag]

                                            [command]
                                                {VARIABLE objective_picked revoke_objective_orders}
                                            [/command]
                                        [/value]

                                        [value]
                                            label=_"Back"

                                            [command]
                                            [/command]
                                        [/value]
                                    [/set_variables]

                                    [insert_tag]
                                        name=message
                                        variable=set_objective_message
                                    [/insert_tag]

                                    [if]
                                        [variable]
                                            name=objective_picked
                                            not_equals=$empty
                                        [/variable]

                                        [then]
                                            [insert_tag]
                                                name=command
                                                variable=ai_controller_{AFFIX}.$objective_picked|.actions_when_applied
                                            [/insert_tag]

                                            {VARIABLE ai_controller.side_$ally_side|_current_settings.current_objective $objective_picked}
                                            {VARIABLE ai_controller.side_$ally_side|_current_settings.currently_doing_objective_description $ai_controller_{AFFIX}.$objective_picked|.currently_doing_description|}
                                        [/then]
                                    [/if]

                                    {CLEAR_VARIABLE set_objective_message,objective_picked}
                                [/command]
                            [/literal]

                            [literal]
                                label= _ "Set behavior..."

                                [command]
                                    [set_variables]
                                        name=set_behavior_message

                                        [insert_tag]
                                            name=value
                                            variable=header_message
                                        [/insert_tag]
                                    [/set_variables]

                                    {CLEAR_VARIABLE set_behavior_message.option}

                                    [set_variables]
                                        name=set_behavior_message.option

                                        [value]
                                            label=$ai_controller_{AFFIX}.aggression.option_description

                                            [insert_tag]
                                                name=show_if
                                                variable=ai_controller_{AFFIX}.aggression.show_if
                                            [/insert_tag]

                                            [command]
                                                {VARIABLE behavior_picked aggression}
                                            [/command]
                                        [/value]

                                        [value]
                                            label=$ai_controller_{AFFIX}.caution.option_description

                                            [insert_tag]
                                                name=show_if
                                                variable=ai_controller_{AFFIX}.caution.show_if
                                            [/insert_tag]

                                            [command]
                                                {VARIABLE behavior_picked caution}
                                            [/command]
                                        [/value]

                                        [value]
                                            label=$ai_controller_{AFFIX}.revoke_behavior_orders.option_description

                                            [insert_tag]
                                                name=show_if
                                                variable=ai_controller_{AFFIX}.revoke_behavior_orders.show_if
                                            [/insert_tag]

                                            [command]
                                                {VARIABLE behavior_picked revoke_behavior_orders}
                                            [/command]
                                        [/value]

                                        [value]
                                            label=_"Back"

                                            [command]
                                            [/command]
                                        [/value]
                                    [/set_variables]

                                    [insert_tag]
                                        name=message
                                        variable=set_behavior_message
                                    [/insert_tag]

                                    [if]
                                        [variable]
                                            name=behavior_picked
                                            not_equals=$empty
                                        [/variable]

                                        [then]
                                            [insert_tag]
                                                name=command
                                                variable=ai_controller_{AFFIX}.$behavior_picked|.actions_when_applied
                                            [/insert_tag]

                                            {VARIABLE ai_controller.side_$ally_side|_current_settings.current_behavior $behavior_picked}
                                            {VARIABLE ai_controller.side_$ally_side|_current_settings.currently_doing_behavior_description $ai_controller_{AFFIX}.$behavior_picked|.currently_doing_description|}
                                        [/then]
                                    [/if]

                                    {CLEAR_VARIABLE set_behavior_message,behavior_picked}
                                [/command]
                            [/literal]

                            [literal]
                                label=$ai_controller_{AFFIX}.revoke_all_orders.option_description

                                [insert_tag]
                                    name=show_if
                                    variable=ai_controller_{AFFIX}.revoke_all_orders.show_if
                                [/insert_tag]

                                [insert_tag]
                                    name=command
                                    variable=ai_controller_{AFFIX}.revoke_all_orders.actions_when_applied
                                [/insert_tag]
                            [/literal]

                            [literal]
                                label=_"Exit"

                                [command]
                                    {VARIABLE ai_controller_finished yes}

#ifndef MULTIPLAYER
                                    [allow_undo]
                                    [/allow_undo]
#endif
                                [/command]
                            [/literal]
                        [/set_variables]

                        {CLEAR_VARIABLE header_message}

                        [insert_tag]
                            name=message
                            variable=ai_controller_{AFFIX}.main_menu_message
                        [/insert_tag]
                    [/do]
                [/while]

                {CLEAR_VARIABLE ally_unit,ally_side,ally_leader,ai_controller_{AFFIX}.main_menu_message,ai_controller_finished}
            [/command]
        [/set_menu_item]
    [/event]

    [event]
        name=victory

        {CLEAR_VARIABLE ai_controller,ai_controller_{AFFIX}}
    [/event]
#enddef
